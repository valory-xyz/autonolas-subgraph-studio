specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  # --- Legacy Mech Factories ---
  - kind: ethereum/contract
    name: LegacyMechFactory1
    network: xdai
    source:
      address: "0x88de734655184a09b70700ae4f72364d1ad23728"
      abi: Factory
      startBlock: 27911512
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wassm/assemblyscript
      entities: [LegacyMech]
      abis:
        - name: Factory
          file: ../../abis/AgentFactoryV1.json
      file: ./src/mapping.ts
      eventHandlers:
        - event: CreateMech(indexed address,indexed uint256,indexed uint256)
          handler: handleCreateMech

  - kind: ethereum/contract
    name: LegacyMechFactory2
    network: xdai
    source:
      address: "0x4be7a91e67be963806fefa9c1fd6c53dfc358d94"
      abi: Factory
      startBlock: 30662989
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wassm/assemblyscript
      entities: [LegacyMech]
      abis:
        - name: Factory
          file: ../../abis/AgentFactoryV2.json
      file: ./src/mapping.ts
      eventHandlers:
        - event: CreateMech(indexed address,indexed uint256,indexed uint256)
          handler: handleCreateMech
  
  - kind: ethereum/contract
    name: LegacyMechFactory3
    network: xdai
    source:
      address: "0x2acd313b892c9922e470e4950e907d5eaa70fc2a"
      abi: Factory
      startBlock: 35714019
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wassm/assemblyscript
      entities: [LegacyMech]
      abis:
        - name: Factory
          file: ../../abis/AgentFactoryV3.json
      file: ./src/mapping.ts
      eventHandlers:
        - event: CreateMech(indexed address,indexed uint256,indexed uint256)
          handler: handleCreateMech

  - kind: ethereum/contract
    name: LegacyMechFactory4
    network: xdai
    source:
      address: "0x6d8cbebcad7397c63347d44448147db05e7d17b0"
      abi: Factory
      startBlock: 36582492
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wassm/assemblyscript
      entities: [LegacyMech]
      abis:
        - name: Factory
          file: ../../abis/AgentFactoryV4.json
      file: ./src/mapping.ts
      eventHandlers:
        - event: CreateMech(indexed address,indexed uint256,indexed uint256)
          handler: handleCreateMech

templates:
  - name: LegacyMech
    kind: ethereum/contract
    network: xdai
    source:
      abi: AgentMech
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/mapping.ts
      entities: [LegacyMech, Global]
      abis:
        - name: AgentMech
          file: ../../abis/AgentMech.json
      callHandlers:
        - function: exec(address,uint256,bytes,uint8,uint256)
          handler: handleExec
        - function: request(bytes)
          handler: handleRequest