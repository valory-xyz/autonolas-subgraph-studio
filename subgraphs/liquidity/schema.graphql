type LPTransfer @entity(immutable: true) {
  id: Bytes! # transaction hash + log index
  from: Bytes! # address
  to: Bytes! # address
  value: BigInt! # LP tokens transferred (in wei)
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type PoolReserves @entity(immutable: false) {
  id: Bytes! # pool contract address
  reserve0: BigInt! # OLAS reserves (in wei)
  reserve1: BigInt! # ETH reserves (in wei)
  lastSyncBlock: BigInt!
  lastSyncTimestamp: BigInt!
  lastSyncTransaction: Bytes!
}


# Treasury LP token holdings tracker
type TreasuryHoldings @entity(immutable: false) {
  id: Bytes! # treasury address
  currentBalance: BigInt! # current LP token balance
  totalAcquired: BigInt! # cumulative acquired
  totalSold: BigInt! # cumulative sold
  firstTransactionTimestamp: BigInt!
  lastTransactionTimestamp: BigInt!
  transactionCount: Int!
}

# Global LP token metrics
type LPTokenMetrics @entity(immutable: false) {
  id: ID! # "" (empty string singleton)
  
  # Supply metrics
  totalSupply: BigInt! # current total LP supply
  totalMinted: BigInt! # cumulative minted
  totalBurned: BigInt! # cumulative burned
  
  # Treasury metrics
  treasurySupply: BigInt! # LP tokens held by treasury
  treasuryPercentage: BigInt! # treasury % of total (in basis points, 10000 = 100%)
  
  # Pool metrics
  currentReserve0: BigInt! # current OLAS reserves
  currentReserve1: BigInt! # current ETH reserves

  # USD valuations
  poolLiquidityUsd: BigDecimal! # total pool value in USD
  protocolOwnedLiquidityUsd: BigDecimal! # treasury's share in USD
  # Price semantics vary by DEX type (field name kept for backward compatibility):
  # - Uniswap V2 chains (Ethereum, Celo): ETH or CELO price from Chainlink oracle
  # - Balancer V2 chains (Gnosis, Polygon, Arbitrum, Optimism, Base): OLAS spot price from pool
  # TODO: Rename to 'lastPriceUsd' in next major version for semantic clarity
  lastEthPriceUsd: BigDecimal!

  # Timestamps
  lastUpdated: BigInt!
  firstTransferTimestamp: BigInt!
}

# Bridged LP token holdings from L2 chains
type BridgedPOL @entity(immutable: false) {
  id: ID!                           # "polygon" | "arbitrum" | "optimism" | "base"
  chain: String!                    # Source chain name
  tokenAddress: Bytes!              # Bridged token contract on Ethereum
  tokenName: String!                # e.g., "50WMATIC-50OLAS"
  treasuryBalance: BigInt!          # Current Treasury holdings
  totalAcquired: BigInt!            # Cumulative acquired
  totalSold: BigInt!                # Cumulative sold
  lastUpdated: BigInt!              # Block timestamp
  transactionCount: Int!            # Number of transfers
}
