# Entity is only created if trader agent (with id 86) is registered in a service
# Allows tracking TraderAgent properly
type TraderService @entity (immutable: true) {
  id: Bytes! # serviceId
}

type TraderAgent @entity (immutable: false) {
  id: Bytes!
  serviceId: BigInt!
  firstParticipation: BigInt
  lastActive: BigInt
  totalBets: Int!
  totalTraded: BigInt! # trades amount for settled markets (when we have answer)
  totalPayout: BigInt! # all bets including for open markets
  totalFees: BigInt! # fees amount for settled markets (when we have answer)
  # bets: [Bet!]! @derivedFrom(field: "bettor")
  # dailyProfitStatistics: [DailyProfitStatistic!]! @derivedFrom(field: "traderAgent")
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type QuestionIdToConditionId @entity(immutable: true) {
  id: Bytes!
  conditionId: Bytes! # bytes32
}

type Question @entity(immutable: false) {
  id: Bytes! # conditionId
  questionId: Bytes! # bytes32
  metadata: MarketMetadata
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type MarketMetadata @entity(immutable: true) {
  id: Bytes! # questionId
  title: String!
  outcomes: [String!]!
  rawAncillaryData: String!
}

type Bet @entity (immutable: false) {
  id: Bytes!
  bettor: TraderAgent!
  outcomeIndex: BigInt!
  amount: BigInt!   # USDC spent (e.g., 1.00)
  shares: BigInt!   # Tokens received (e.g., 2.17)
  # countedInProfit: Boolean!
  countedInTotal: Boolean
  question: Question
  # dailyStatistic: DailyProfitStatistic
  timestamp: BigInt!
}

# Maps tokenId to conditionId and outcome index for tracking trades
type TokenRegistry @entity(immutable: true) {
  id: Bytes! # tokenId as string
  tokenId: BigInt!
  conditionId: Bytes!
  outcomeIndex: BigInt! # 0 or 1 for binary markets
}

type Global @entity (immutable: false) {
  id: ID!
  totalTraderAgents: Int!
  totalActiveTraderAgents: Int!
  totalBets: Int! # all bets including for open markets
  totalPayout: BigInt!
  totalTraded: BigInt! # trades amount for settled markets (when we have answer)
  totalFees: BigInt! # fees amount for settled markets (when we have answer)
}